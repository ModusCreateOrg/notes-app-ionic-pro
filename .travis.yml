---
# Environment variables: https://docs.travis-ci.com/user/environment-variables/#Default-Environment-Variables
branches:
  # Safelist
  only:
    - feature/travis-build-integration
git:
  depth: 1
matrix:
  include:
    -
      # Including OSX later will allow us to run a Build Matrix.
      os: linux
      sudo: false
      # Source: https://docs.travis-ci.com/user/languages/android/
      language: android
      android:
        # If components are missing on build, do `android list sdk --no-ui --all --extended`
        # in local dev environment to find out what's missing.
        components:
          # Note that the tools section appears twice on purpose as itâ€™s required to get the newest Android SDK tools.
          # See: https://docs.travis-ci.com/user/languages/android/#Installing-a-newer-SDK-Platform-Tools-revision
          - tools
          - platform-tools
          - tools

          # The BuildTools version used by your project
          - build-tools-26.0.2

          # The SDK version used to compile your project
          - android-26

          # Additional components
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
          - addon-google_apis-google-26

          # Specify at least one system image,
          # if you need to run emulator(s) during your tests
          - sys-img-armeabi-v7a-android-26
          - sys-img-armeabi-v7a-android-17

          # Install Android SDK components.
          - sys-img-armeabi-v7a-android-tv-l
          - add-on
          - extra
  addons:
    apt:
      sources:
        - 
          sourceline: "deb https://dl.yarnpkg.com/debian/ stable main"
          key_url: "https://dl.yarnpkg.com/debian/pubkey.gpg"
      packages:
        - oracle-java8-installer
        - oracle-java8-set-default
        - yarn
  licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+
before_cache:
  - "rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock"
  - "rm -fr $HOME/.gradle/caches/*/plugin-resolution/"
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache
    - $HOME/.cache/yarn
before_install:
  - "export LANG=en_US.UTF-8"
  # v8 is the active LTS release.
  - "nvm install 8"
  - "yarn global add ionic cordova"
script:
  # Run tests here.
  - "echo \"Travis branch is $TRAVIS_BRANCH\""
  - "echo \"Travis branch is in pull request $TRAVIS_PULL_REQUEST\""
  - ./travis/build/run.sh
after_failure:
  - "echo \"[FAIL] Build result is $TRAVIS_TEST_RESULT\""
after_success:
  - "echo \"[PASS] Build result is $TRAVIS_TEST_RESULT\""
env:
  global:
    - JAVA_HOME=/usr/lib/jvm/java-8-oracle
    - JRE_HOME=/usr/lib/jvm/java-8-oracle/jre
    - S3_BUCKET="041440807701-us-west-2-device-farm"
    - ANDROID_BUILD_DIR="${TRAVIS_BUILD_DIR}/platforms/android/build/outputs/apk/debug"
    - ANDROID_DEBUG_APK_NAME="android-debug-${TRAVIS_BUILD_NUMBER}-${TRAVIS_BUILD_ID}.apk"
    - ANDROID_BUILD_LATEST_DIR="${ANDROID_BUILD_DIR}"/latest
    # AWS_ACCESS_KEY_ID
    - secure: "Qx7qPgynshVDgHVT58CkW83joEJqVE27jniHSJSFnqgpeMQjpNi9syjr2rb6ELLH6Z70fCYz3rQ+eSoVok68/r/3JByi52a9Osj4M+vKlKtUxMbEltoXQhMEc6nV7vIxjzJzBRV2VlTz1lsr9jGj4EYJ1nUWXIa8gfOcLhij1FOm4Glle0R/DKF5wRlIS4AJOTuAPT7m2KPOmoWK7Z+KFyja5DQDd1p4dcpGCGbEE1dOfBj9l6kvg4WcaJv6DnGNtcP7xXpyQZIrrTiJCft7Nh5k8vDiKkaMvSgQ2qNn6OJYUinzdIzIXnlEfh6UpAwEoaOs9qsnbErpbRN/v1rj4sm25N4zB9VxOOW0RMe/zjNwEy2HIS/enZu1adS0eqTUdLOPD38C7iL4nMLghWgB5ETcTvo/yENmoh7wR/F+LVmuV7GZaAQZRkocGqWZPQeEFWxpL4WaG36Uz1vREbglfcoDDtFZUq5q7Am4EBn6oU/T5FBiSPXUhiTTpfDc9A65Hl4BOkxJ9fPwnphEOdG+bIiSamhkC55UPv1PY1kty0YMMxwXzQda34WdgZBsiBGSWgA+VtRBSGcXW3Gsnuj1+q0PKByn8gUuNjL83GFPuBwoOzUzWqBk+nfCuW8x1S0/0UNSJ4dVVRiOGZgiopI/De86kIvp09i1JPhNFyM5Zow="
    # AWS_SECRET_ACCESS_KEY
    - secure: "RikpP42OjbKCMLQO7jIDUDDdmjkDPR3i9j4IZvrpHlBiw4nnjJePL8yESv8xRHYjwZORQG8I9ejCNpruec42Q7Kjt/UMiYxJdP0rRRgnx8jbQXpWWA8++Fh3kv0CSLjfSuRkvyJjV/09+QmWTBsx1cz1ncpTqgyGgAN/yLFgu91ewcohBSi1pk1c4ITilQlnkmtjkQnNDR5CUX6Vyhl95QNWaTGQQAvVzthZvhaWeG5WNYUDyCg2auzq4hxwtc+geFlQaENV3rBfU899UL71S4UU9CFndMfbPAOLUi5spZsBdUQT8n2xvcsemdQdYPrt29zLPZsBfJiOp77kWp5FHYgG7VLKmPAFXARDi1LatTCVexct6FAt646VvzrYx/lzndDmtWzIinNUAbLFq7FGmDUVEzCqyeL4U3SCDbmVUy4LkO6ELyW/E6tDixlZt2Riqdzhs8kOUJ6fx7WaQKzX26yCQJbfh2Qkcfh2gaLrYVbtStc9S00+sIkIICpMG+szeiIv2t9XQ+Q4Jm2eYU+SynAbKWUBThSIfMRMTq1ozzGRfwffy4NMrAITLwwm1L92yo+5M5eIp0IJK7rOSKiBS1eVTFpZFcPmK+C4T3JAoqFlAn2AfTVqhfl3QRFs8oJoKcvNX2S6Pl8w0y5HK/dmggG4ova57+kSXMh/6cMKWd0="
before_deploy:
  - ./travis/deploy/before/prepare.sh
deploy:
  provider: s3
  access_key_id: "${AWS_ACCESS_KEY_ID}"
  secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
  skip_cleanup: true
  bucket: "${S3_BUCKET}"
  local_dir: "${ANDROID_BUILD_LATEST_DIR}"
  on:
    all_branches: true
# after_deploy:
#   - ./travis/deploy/after/run_tests.sh
#   - ./travis/deploy/after/check_results.sh